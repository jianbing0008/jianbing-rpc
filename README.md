# Jianbing-RPC 

ä¸€ä¸ªåŸºäºNettyå’ŒZooKeeperå®ç°çš„è½»é‡çº§RPCæ¡†æ¶ï¼Œä¸“ä¸ºåˆ†å¸ƒå¼ç³»ç»Ÿé€šä¿¡è®¾è®¡ã€‚

## ğŸ“¦ æ ¸å¿ƒç‰¹æ€§

- **é«˜æ€§èƒ½é€šä¿¡**ï¼šåŸºäºNettyçš„NIOæ¨¡å‹å®ç°
- **æœåŠ¡æ²»ç†**ï¼šZooKeeperæ³¨å†Œä¸­å¿ƒæ”¯æŒ
- **åè®®å®šåˆ¶**ï¼šè‡ªå®šä¹‰äºŒè¿›åˆ¶é€šä¿¡åè®®
- **å¿ƒè·³æ£€æµ‹**ï¼šæ”¯æŒæœåŠ¡å¥åº·ç›‘æµ‹
- **å¼‚æ­¥è°ƒç”¨**ï¼šCompletableFutureå®ç°è¯·æ±‚å“åº”æ¨¡å‹

## ğŸ› ï¸ æŠ€æœ¯æ ˆ

| ç»„ä»¶      | ç‰ˆæœ¬ | ç”¨é€”             |
| --------- | ---- | ---------------- |
| Netty     | 4.x  | ç½‘ç»œé€šä¿¡æ¡†æ¶     |
| ZooKeeper | 3.7+ | æœåŠ¡æ³¨å†Œä¸å‘ç°   |
| JDK       |  17  | åŠ¨æ€ä»£ç†/NIOæ”¯æŒ |


## ğŸ” æ ¸å¿ƒè®¾è®¡

### åè®®æ ¼å¼

```
 0               1               2               3               4          
+---------------+---------------+---------------+---------------+
|  Magic(12B)   | Version(1B)   | Header Len(2B)| Full Len(4B)  | --> Header
+---------------+---------------+---------------+---------------+
| ReqType(1B)   | Serialize(1B) | Compress(1B)  | RequestId(8B) | --> Meta
+---------------+---------------+---------------+---------------+
|                                  Body                         | --> Payload
+---------------------------------------------------------------+
```

- **Magic Number**: `Jianbing-RPC` æ ‡è¯†åè®®
- **Header Length**: å›ºå®š30å­—èŠ‚
- **Request Types**:
  - `0x01` æ™®é€šè¯·æ±‚
  - `0x02` å¿ƒè·³æ£€æµ‹

### é€šä¿¡æµç¨‹

```mermaid
sequenceDiagram
    Consumer->>+ZooKeeper: 1.æœåŠ¡å‘ç°
    ZooKeeper-->>-Consumer: 2.è¿”å›æœåŠ¡åœ°å€
    Consumer->>+Provider: 3.å»ºç«‹è¿æ¥
    loop å¿ƒè·³æ£€æµ‹
        Consumer->>Provider: 4.å¿ƒè·³åŒ…
        Provider-->>Consumer: 5.å¿ƒè·³å“åº”
    end
    Consumer->>Provider: 6.RPCè°ƒç”¨
    Provider-->>Consumer: 7.è¿”å›ç»“æœ
```


## ğŸ”§ é…ç½®å‚æ•°

| å‚æ•°               | é»˜è®¤å€¼         | è¯´æ˜         |
| :----------------- | :------------- | :----------- |
| zookeeper.address  | 127.0.0.1:2181 | æ³¨å†Œä¸­å¿ƒåœ°å€ |
| netty.port         | 8088           | æœåŠ¡ç«¯å£     |
| rpc.timeout        | 10s            | è°ƒç”¨è¶…æ—¶æ—¶é—´ |
| heartbeat.interval | 30s            | å¿ƒè·³æ£€æµ‹é—´éš” |

## ğŸš§ æœªæ¥ä¼˜åŒ–

- å¢åŠ ç†”æ–­é™çº§æœºåˆ¶
- æ•´åˆè¿›Spring boot



